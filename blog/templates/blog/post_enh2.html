{% extends "blog/datalogs_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}

{% load datalog_tags %}

{% block datalogs_title %}DataLogs Archive{% endblock %}

{% block datalogs_css %}
<link rel="stylesheet" href="{% static 'blog/css/post_enh2.css' %}">
{% pygments_css %}
{% endblock %}

{% block show_breadcrumbs %}False{% endblock %}
{% block show_filters %}True{% endblock %}

{% block datalogs_content %}

<!-- Categories Glass Container - Clean, Minimal Design -->
<section class="categories-glass-section">
    <div class="container">
        <div class="categories-glass-container">
            <div class="categories-scroll-wrapper">
                <button class="category-scroll-btn category-scroll-left" id="categoryScrollLeft" aria-label="Scroll categories left">
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <div class="categories-grid-container" id="categoriesGrid">
                    <!-- All Categories Option -->
                    <a href="{% url 'blog:post_list' %}" class="category-item {% if not current_category %}active{% endif %}" data-category="all">
                        <div class="category-hex-wrapper">
                            <div class="category-hexagon" style="--hex-color: var(--color-teal);">
                                <span class="hex-code">ALL</span>
                            </div>
                            <div class="category-glow-effect"></div>
                        </div>
                        <div class="category-info">
                            <span class="category-name">All DataLogs</span>
                            <span class="category-count">{{ total_posts|default:"24" }}</span>
                        </div>
                    </a>
                    
                    <!-- Individual Categories -->
                    {% for category in categories_with_counts %}
                    <a href="{% url 'blog:category' slug=category.slug %}" 
                       class="category-item {% if category.slug == current_category.slug %}active{% endif %}"
                       data-category="{{ category.slug }}">
                        <div class="category-hex-wrapper">
                            <div class="category-hexagon" style="--hex-color: {{ category.color|default:'var(--color-lavender)' }};">
                                <span class="hex-code">{{ category.code|default:category.name|slice:":2"|upper }}</span>
                            </div>
                            <div class="category-glow-effect"></div>
                        </div>
                        <div class="category-info">
                            <span class="category-name">{{ category.name }}</span>
                            <span class="category-count">{{ category.post_count }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                
                <button class="category-scroll-btn category-scroll-right" id="categoryScrollRight" aria-label="Scroll categories right">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Enhanced Search Section -->
<section class="datalogs-search-section">
    <div class="container">
        <!-- Main Search Interface -->
        <div class="search-interface-container">
            <form method="get" action="{% url 'blog:search' %}" class="search-form-enhanced">
                {% search_input name="q" placeholder="Search DataLog entries, code snippets, and technical insights..." value=query css_class="search-main-input" %}
                
                <!-- Real-time Search Suggestions -->
                <div class="search-suggestions-container" id="searchSuggestions" style="display: none;">
                    <div class="suggestions-header">
                        <i class="fas fa-search"></i>
                        <span>Search Suggestions</span>
                    </div>
                    <div class="suggestions-list" id="suggestionsList">
                        <!-- Dynamic suggestions populated by JavaScript -->
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Quick Filter Tags -->
        <div class="quick-filters-section">
            <div class="filter-label-section">
                <i class="fas fa-sliders-h"></i>
                <span class="filter-label">Quick Filters</span>
            </div>
            <div class="filter-tags-container">
                <a href="?featured=true" class="filter-tag {% if request.GET.featured %}active{% endif %}" data-filter="featured">
                    <i class="fas fa-star"></i>
                    <span>Featured</span>
                </a>
                <a href="?has_code=true" class="filter-tag {% if request.GET.has_code %}active{% endif %}" data-filter="code">
                    <i class="fas fa-code"></i>
                    <span>Code Examples</span>
                </a>
                <a href="?reading_time=quick" class="filter-tag {% if 'quick' in request.GET.reading_time %}active{% endif %}" data-filter="quick">
                    <i class="fas fa-clock"></i>
                    <span>Quick Read</span>
                </a>
                {% for category in categories|slice:":3" %}
                <a href="{% url 'blog:category' slug=category.slug %}" class="filter-tag" data-filter="{{ category.slug }}">
                    <i class="{{ category.icon|default:'fas fa-folder' }}"></i>
                    <span>{{ category.name }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Featured DataLog Entry - Split Layout with Terminal -->
{% if featured_post %}
<section class="featured-datalog-section">
    <div class="container">
        {% section_header title="Featured DataLog Entry" subtitle="Highlighted Technical Implementation" icon="fas fa-star" show_metrics=False %}
        
        <div class="featured-post-container">
            <!-- Content Section - Left Side -->
            <div class="featured-content-section">
                <div class="featured-meta-section">
                    {% if featured_post.category %}
                    <div class="category-indicator" style="--category-color: {{ featured_post.category.color|default:'var(--color-lavender)' }};">
                        <span class="category-code">{{ featured_post.category.code|default:featured_post.category.name|slice:":2"|upper }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="post-metadata">
                        <span class="post-date">
                            <i class="fas fa-calendar"></i>
                            {{ featured_post.published_date|date:"M d, Y" }}
                        </span>
                        <span class="reading-time">
                            <i class="fas fa-clock"></i>
                            {{ featured_post.reading_time }}min read
                        </span>
                        <span class="difficulty-level">
                            <i class="fas fa-signal"></i>
                            {{ featured_post|datalog_difficulty }}
                        </span>
                    </div>
                </div>
                
                <div class="featured-title-section">
                    <h2 class="featured-title">
                        <a href="{{ featured_post.get_absolute_url }}">{{ featured_post.title }}</a>
                    </h2>
                    {% if featured_post.subtitle %}
                    <p class="featured-subtitle">{{ featured_post.subtitle }}</p>
                    {% endif %}
                </div>
                
                <div class="featured-excerpt-section">
                    <p class="featured-excerpt">
                        {{ featured_post.excerpt|default:featured_post.content|truncate_smart:200 }}
                    </p>
                </div>
                
                <!-- Tags Section -->
                {% if featured_post.tags.exists %}
                <div class="featured-tags-section">
                    {% for tag in featured_post.tags.all|slice:":4" %}
                    <a href="{% url 'blog:tag' slug=tag.slug %}" class="datalog-tag">
                        #{{ tag.name }}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="featured-actions-section">
                    <a href="{{ featured_post.get_absolute_url }}" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        <span>Read Full DataLog</span>
                    </a>
                    {% if featured_post|has_system_connection %}
                    <a href="#" class="btn btn-outline" onclick="showSystemConnections({{ featured_post.id }})">
                        <i class="fas fa-project-diagram"></i>
                        <span>View Connected Systems</span>
                    </a>
                    {% endif %}
                </div>
            </div>
            
            <!-- Terminal Code Display - Right Side -->
            {% if featured_post.featured_code %}
            <div class="featured-terminal-section">
                <div class="terminal-container">
                    <!-- Terminal Header -->
                    <div class="terminal-header">
                        <div class="terminal-controls">
                            <div class="terminal-dot terminal-close"></div>
                            <div class="terminal-dot terminal-minimize"></div>
                            <div class="terminal-dot terminal-maximize"></div>
                        </div>
                        <div class="terminal-title-section">
                            <span class="terminal-filename">{{ featured_post.get_code_filename }}</span>
                        </div>
                        <div class="terminal-status-section">
                            <span class="code-language-indicator">{{ featured_post.featured_code_format|upper }}</span>
                            <div class="status-indicator operational"></div>
                        </div>
                    </div>
                    
                    <!-- Terminal Content -->
                    <div class="terminal-content">
                        <div class="code-display-container">
                            {{ featured_post.featured_code|highlight_code:featured_post.featured_code_format }}
                        </div>
                    </div>
                    
                    <!-- Terminal Footer -->
                    <div class="terminal-footer">
                        <div class="terminal-info-section">
                            <div class="code-metrics">
                                <span class="metric-item">
                                    <i class="fas fa-list-ol"></i>
                                    {{ featured_post.featured_code|code_line_count }} lines
                                </span>
                                <span class="metric-item">
                                    <i class="fas fa-cube"></i>
                                    {{ featured_post.featured_code|code_complexity }}
                                </span>
                                <span class="metric-item">
                                    <i class="fas fa-code"></i>
                                    {{ featured_post.featured_code_format }}
                                </span>
                            </div>
                        </div>
                        <div class="terminal-actions-section">
                            {% copy_button featured_post.featured_code "Copy Code" "Code Copied!" %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- DataLogs Grid Section -->
<section class="datalogs-grid-section">
    <div class="container">
        <!-- Grid Header with Stats and Controls -->
        <div class="grid-header-section">
            <div class="grid-statistics">
                <div class="stat-display">
                    <span class="stat-value">{{ posts|length }}</span>
                    <span class="stat-label">Showing</span>
                </div>
                <div class="stat-separator">|</div>
                <div class="stat-display">
                    <span class="stat-value">{{ page_obj.paginator.count|default:"24" }}</span>
                    <span class="stat-label">Total Entries</span>
                </div>
                {% if current_category %}
                <div class="stat-separator">|</div>
                <div class="stat-display">
                    <span class="stat-value">{{ current_category.name }}</span>
                    <span class="stat-label">Category</span>
                </div>
                {% endif %}
                <div class="stat-separator">|</div>
                <div class="stat-display">
                    <span class="stat-value">{{ avg_reading_time|default:"8" }}min</span>
                    <span class="stat-label">Avg Read</span>
                </div>
            </div>
            
            <div class="view-controls-section">
                <div class="view-toggle-buttons">
                    <button class="view-toggle-btn active" data-view="grid" title="Grid View" aria-label="Grid view">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button class="view-toggle-btn" data-view="list" title="List View" aria-label="List view">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="view-toggle-btn" data-view="timeline" title="Timeline View" aria-label="Timeline view">
                        <i class="fas fa-stream"></i>
                    </button>
                </div>
                <div class="sort-controls">
                    <select class="sort-select" id="sortSelect">
                        <option value="-published_date">Latest First</option>
                        <option value="published_date">Oldest First</option>
                        <option value="title">Title A-Z</option>
                        <option value="-reading_time">Longest Read</option>
                        <option value="reading_time">Quick Read</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- DataLog Entries Grid -->
        <div class="datalogs-grid" id="datalogsGrid">
            {% for post in posts %}
            <article class="datalog-entry-card" data-category="{{ post.category.slug|default:'general' }}" data-tags="{% for tag in post.tags.all %}{{ tag.slug }} {% endfor %}">
                <!-- Card Image Section -->
                {% if post.thumbnail %}
                <div class="card-image-section">
                    <img src="{{ post.thumbnail.url }}" alt="{{ post.title }}" loading="lazy" class="datalog-image">
                    <div class="image-overlay-section">
                        {% if post.featured %}
                        <div class="featured-indicator">
                            <i class="fas fa-star"></i>
                        </div>
                        {% endif %}
                        {% if post.featured_code %}
                        <div class="code-indicator">
                            <i class="fas fa-code"></i>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Card Content Section -->
                <div class="card-content-section">
                    <!-- Meta Information -->
                    <div class="card-meta-section">
                        {% if post.category %}
                        <div class="category-mini-indicator" style="--category-color: {{ post.category.color|default:'var(--color-lavender)' }};">
                            <span class="category-mini-code">{{ post.category.code|default:post.category.name|slice:":2"|upper }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="post-meta-info">
                            <span class="post-date-info">{{ post.published_date|time_since_published }}</span>
                            <span class="reading-time-info">{{ post.reading_time }}min</span>
                            <span class="difficulty-info">{{ post|datalog_difficulty }}</span>
                        </div>
                    </div>
                    
                    <!-- Title and Content -->
                    <div class="card-main-content">
                        <h3 class="datalog-card-title">
                            <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                        </h3>
                        
                        {% if post.excerpt %}
                        <p class="datalog-card-excerpt">{{ post.excerpt|truncate_smart:120 }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Footer Section -->
                    <div class="card-footer-section">
                        <div class="card-stats-info">
                            {% if post.tags.exists %}
                            <span class="card-stat-item">
                                <i class="fas fa-tags"></i>
                                {{ post.tags.count }}
                            </span>
                            {% endif %}
                            {% if post|has_system_connection %}
                            <span class="card-stat-item">
                                <i class="fas fa-project-diagram"></i>
                                System
                            </span>
                            {% endif %}
                            {% if post.featured_code %}
                            <span class="card-stat-item">
                                <i class="fas fa-code"></i>
                                {{ post.featured_code_format|upper }}
                            </span>
                            {% endif %}
                        </div>
                        
                        <a href="{{ post.get_absolute_url }}" class="read-datalog-btn">
                            <span>Read Entry</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </article>
            {% empty %}
            <!-- No Posts Message -->
            <div class="no-datalogs-message">
                <div class="no-posts-icon-section">
                    <i class="fas fa-database"></i>
                </div>
                <h3>No DataLog Entries Found</h3>
                <p>Adjust your search criteria or browse all categories to find relevant technical insights.</p>
                <div class="no-posts-actions">
                    <a href="{% url 'blog:post_list' %}" class="btn btn-outline">
                        <i class="fas fa-refresh"></i>
                        <span>Reset Filters</span>
                    </a>
                    <a href="{% url 'blog:post_list' %}?featured=true" class="btn btn-primary">
                        <i class="fas fa-star"></i>
                        <span>View Featured</span>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Enhanced Pagination -->
        {% if is_paginated %}
        <div class="pagination-section">
            <nav class="datalog-pagination-nav">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="pagination-nav-btn pagination-prev">
                    <i class="fas fa-chevron-left"></i>
                    <span>Previous</span>
                </a>
                {% endif %}
                
                <div class="pagination-info-section">
                    <div class="pagination-current">
                        <span class="current-page">{{ page_obj.number }}</span>
                        <span class="page-separator">of</span>
                        <span class="total-pages">{{ page_obj.paginator.num_pages }}</span>
                    </div>
                    <div class="pagination-range">
                        <span class="range-text">
                            Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} entries
                        </span>
                    </div>
                </div>
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="pagination-nav-btn pagination-next">
                    <span>Next</span>
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</section>

{% endblock %}

{% block datalogs_js %}
<script src="{% static 'blog/js/post_enh2.js' %}"></script>
{% endblock %}

<!-- Enhanced DataLogs Interface JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ Enhanced DataLogs Interface Loading...');
    
    // Initialize enhanced components
    initEnhancedCategories();
    initEnhancedSearch();
    initFeaturedTerminal();
    initViewControls();
    initCardAnimations();
    initFilterSystem();
    
    console.log('âœ… Enhanced DataLogs Interface Loaded Successfully');
});

// Enhanced Categories with smooth scrolling
function initEnhancedCategories() {
    const scrollContainer = document.getElementById('categoriesGrid');
    const leftBtn = document.getElementById('categoryScrollLeft');
    const rightBtn = document.getElementById('categoryScrollRight');
    
    if (!scrollContainer || !leftBtn || !rightBtn) return;
    
    console.log('ðŸ“‚ Initializing enhanced categories...');
    
    function updateScrollButtons() {
        const { scrollLeft, scrollWidth, clientWidth } = scrollContainer;
        const maxScroll = scrollWidth - clientWidth;
        
        leftBtn.style.opacity = scrollLeft > 10 ? '1' : '0.3';
        leftBtn.disabled = scrollLeft <= 10;
        
        rightBtn.style.opacity = scrollLeft < maxScroll - 10 ? '1' : '0.3';
        rightBtn.disabled = scrollLeft >= maxScroll - 10;
    }
    
    function smoothScroll(direction) {
        const scrollAmount = 250;
        const currentScroll = scrollContainer.scrollLeft;
        const targetScroll = direction === 'left' 
            ? Math.max(0, currentScroll - scrollAmount)
            : Math.min(scrollContainer.scrollWidth - scrollContainer.clientWidth, currentScroll + scrollAmount);
        
        scrollContainer.scrollTo({ left: targetScroll, behavior: 'smooth' });
    }
    
    leftBtn.addEventListener('click', () => smoothScroll('left'));
    rightBtn.addEventListener('click', () => smoothScroll('right'));
    scrollContainer.addEventListener('scroll', throttle(updateScrollButtons, 100));
    
    // Initialize button states
    setTimeout(updateScrollButtons, 100);
    
    // Enhanced category interactions
    const categoryItems = document.querySelectorAll('.category-item');
    categoryItems.forEach((item, index) => {
        // Entrance animation with stagger
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        
        setTimeout(() => {
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, 100);
        
        // Enhanced hover effects
        item.addEventListener('mouseenter', function() {
            const glowEffect = this.querySelector('.category-glow-effect');
            const hexagon = this.querySelector('.category-hexagon');
            
            if (glowEffect) {
                glowEffect.style.opacity = '0.8';
                glowEffect.style.transform = 'scale(1.2)';
            }
            if (hexagon) {
                hexagon.style.transform = 'scale(1.05)';
            }
        });
        
        item.addEventListener('mouseleave', function() {
            const glowEffect = this.querySelector('.category-glow-effect');
            const hexagon = this.querySelector('.category-hexagon');
            
            if (glowEffect) {
                glowEffect.style.opacity = '0.4';
                glowEffect.style.transform = 'scale(1)';
            }
            if (hexagon) {
                hexagon.style.transform = 'scale(1)';
            }
        });
    });
    
    console.log('âœ… Enhanced categories initialized');
}

// Enhanced Search with real-time suggestions
function initEnhancedSearch() {
    const searchInput = document.querySelector('.search-main-input input');
    const suggestions = document.getElementById('searchSuggestions');
    const suggestionsList = document.getElementById('suggestionsList');
    
    if (!searchInput) return;
    
    console.log('ðŸ” Initializing enhanced search...');
    
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const query = this.value.trim();
        
        if (query.length >= 2) {
            searchTimeout = setTimeout(() => {
                loadSearchSuggestions(query);
            }, 300);
        } else {
            hideSuggestions();
        }
    });
    
    function loadSearchSuggestions(query) {
        // Mock suggestions (replace with actual API call)
        const mockSuggestions = [
            { text: 'Machine Learning Fundamentals', type: 'post', icon: 'fas fa-brain' },
            { text: 'Python Data Analysis', type: 'post', icon: 'fab fa-python' },
            { text: 'Django Best Practices', type: 'post', icon: 'fas fa-code' },
            { text: 'API Development', type: 'category', icon: 'fas fa-plug' },
            { text: 'Database Optimization', type: 'tag', icon: 'fas fa-database' }
        ].filter(item => item.text.toLowerCase().includes(query.toLowerCase()));
        
        if (mockSuggestions.length > 0 && suggestionsList) {
            suggestionsList.innerHTML = mockSuggestions.map(item => 
                `<div class="suggestion-item" onclick="selectSuggestion('${item.text}')">
                    <i class="${item.icon}"></i>
                    <span class="suggestion-text">${highlightQuery(item.text, query)}</span>
                    <span class="suggestion-type">${item.type}</span>
                </div>`
            ).join('');
            
            showSuggestions();
        } else {
            hideSuggestions();
        }
    }
    
    function highlightQuery(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }
    
    function showSuggestions() {
        if (suggestions) {
            suggestions.style.display = 'block';
        }
    }
    
    function hideSuggestions() {
        if (suggestions) {
            suggestions.style.display = 'none';  
        }
    }
    
    window.selectSuggestion = function(suggestion) {
        searchInput.value = suggestion;
        hideSuggestions();
        searchInput.closest('form').submit();
    };
    
    // Close suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !suggestions?.contains(e.target)) {
            hideSuggestions();
        }
    });
    
    console.log('âœ… Enhanced search initialized');
}

// Featured Terminal Effects
function initFeaturedTerminal() {
    const terminal = document.querySelector('.terminal-container');
    if (!terminal) return;
    
    console.log('ðŸ’» Initializing featured terminal...');
    
    // Intersection Observer for terminal activation
    const terminalObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                activateTerminal(entry.target);
                terminalObserver.unobserve(entry.target);
            }
        });
    }, { threshold: 0.3 });
    
    terminalObserver.observe(terminal);
    
    function activateTerminal(terminal) {
        terminal.classList.add('terminal-active');
        
        // Animate terminal dots
        const dots = terminal.querySelectorAll('.terminal-dot');
        dots.forEach((dot, index) => {
            setTimeout(() => {
                dot.style.opacity = '1';
                dot.style.transform = 'scale(1)';
            }, index * 200);
        });
        
        // Add typing cursor effect to code
        const codeContainer = terminal.querySelector('.code-display-container');
        if (codeContainer) {
            setTimeout(() => {
                codeContainer.classList.add('typing-complete');
            }, 1000);
        }
    }
    
    console.log('âœ… Featured terminal initialized');
}

// View Controls
function initViewControls() {
    const toggleBtns = document.querySelectorAll('.view-toggle-btn');
    const grid = document.getElementById('datalogsGrid');
    const sortSelect = document.getElementById('sortSelect');
    
    if (!grid) return;
    
    console.log('ðŸ‘ï¸ Initializing view controls...');
    
    // View toggle functionality
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const view = this.dataset.view;
            
            toggleBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Update grid class with smooth transition
            grid.style.opacity = '0.3';
            setTimeout(() => {
                grid.className = `datalogs-grid datalogs-${view}`;
                grid.style.opacity = '1';
            }, 150);
        });
    });
    
    // Sort functionality
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            const sortValue = this.value;
            const url = new URL(window.location);
            url.searchParams.set('sort', sortValue);
            window.location.href = url.toString();
        });
    }
    
    console.log('âœ… View controls initialized');
}

// Card Animations
function initCardAnimations() {
    const cards = document.querySelectorAll('.datalog-entry-card');
    
    if (cards.length === 0) return;
    
    console.log('ðŸŽ¬ Initializing card animations...');
    
    const cardObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
                cardObserver.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        cardObserver.observe(card);
    });
    
    console.log('âœ… Card animations initialized');
}

// Filter System
function initFilterSystem() {
    const filterTags = document.querySelectorAll('.filter-tag');
    
    console.log('ðŸ”§ Initializing filter system...');
    
    filterTags.forEach(tag => {
        tag.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Toggle active state with animation
            this.classList.toggle('active');
            
            // Add click feedback
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
    
    console.log('âœ… Filter system initialized');
}

// System Connections Modal (for featured post)
function showSystemConnections(postId) {
    console.log(`Showing system connections for post ${postId}`);
    // This would open a modal or navigate to system connections
    // Implementation depends on your system connections setup
}

// Utility Functions
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// Performance optimizations
function initPerformanceOptimizations() {
    // Lazy load images
    const images = document.querySelectorAll('.datalog-image');
    
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                    imageObserver.unobserve(img);
                }
            });
        });
        
        images.forEach(img => imageObserver.observe(img));
    }
}

// Initialize performance optimizations
initPerformanceOptimizations();