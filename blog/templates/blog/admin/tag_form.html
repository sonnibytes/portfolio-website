<!-- blog/templates/blog/admin/tag_form.html -->
{% extends "admin/admin_base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block admin_title %}{{ title }} - AURA Admin{% endblock %}

{% block admin_breadcrumb %}DataLogs › {% if object %}Edit Knowledge Tag{% else %}Create Knowledge Tag{% endif %}{% endblock %}

{% block admin_css %}
{{ block.super }}
<style>
.learning-form-container {
    max-width: 800px;
    margin: 0 auto;
}

.form-section {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.form-section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.form-section-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: white;
    margin: 0;
}

.form-section-subtitle {
    font-size: 0.875rem;
    color: #9ca3af;
    margin: 0;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.form-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-field.full-width {
    grid-column: 1 / -1;
}

.form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #e8eaf6;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-input, .form-textarea, .form-select {
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}

.form-input:focus, .form-textarea:focus, .form-select:focus {
    outline: none;
    border-color: #b39ddb;
    box-shadow: 0 0 0 3px rgba(179, 157, 219, 0.1);
}

.form-select option {
    background: #0d0d1f;
    color: white;
}

.tag-type-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.75rem;
    margin-top: 0.75rem;
}

.tag-type-option {
    background: rgba(179, 157, 219, 0.1);
    border: 1px solid rgba(179, 157, 219, 0.2);
    border-radius: 8px;
    padding: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.tag-type-option:hover {
    background: rgba(179, 157, 219, 0.2);
    border-color: #b39ddb;
    transform: translateY(-2px);
}

.tag-type-option.selected {
    background: rgba(179, 157, 219, 0.3);
    border-color: #b39ddb;
}

.tag-type-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    display: block;
}

.tag-type-title {
    font-size: 0.875rem;
    font-weight: 500;
    color: white;
    margin-bottom: 0.25rem;
}

.tag-type-desc {
    font-size: 0.75rem;
    color: #9ca3af;
}

.tag-suggestions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.tag-suggestion {
    background: rgba(179, 157, 219, 0.1);
    border: 1px solid rgba(179, 157, 219, 0.2);
    border-radius: 16px;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    color: #b39ddb;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tag-suggestion:hover {
    background: rgba(179, 157, 219, 0.2);
    border-color: #b39ddb;
}

.tag-preview {
    background: rgba(179, 157, 219, 0.05);
    border: 1px solid rgba(179, 157, 219, 0.1);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.tag-preview-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    color: #b39ddb;
    font-weight: 500;
    font-size: 0.875rem;
}

.tag-display {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    border-radius: 16px;
    font-size: 0.875rem;
    font-weight: 500;
    border: 1px solid;
    transition: all 0.3s ease;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
}

.tag-display.technical {
    background: rgba(34, 197, 94, 0.1);
    border-color: rgba(34, 197, 94, 0.3);
    color: #22c55e;
}

.tag-display.conceptual {
    background: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.3);
    color: #3b82f6;
}

.tag-display.topic {
    background: rgba(251, 191, 36, 0.1);
    border-color: rgba(251, 191, 36, 0.3);
    color: #fbbf24;
}

.tag-display.skill {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.3);
    color: #8b5cf6;
}

.tag-display.tool {
    background: rgba(179, 157, 219, 0.1);
    border-color: rgba(179, 157, 219, 0.3);
    color: #b39ddb;
}

.tag-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.75rem;
    text-align: center;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: #b39ddb;
    display: block;
}

.stat-label {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-top: 0.25rem;
}

.form-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.form-actions-left {
    display: flex;
    gap: 0.75rem;
}

.form-actions-right {
    display: flex;
    gap: 0.75rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: #b39ddb;
    color: white;
}

.btn-primary:hover {
    background: #9c88c2;
    transform: translateY(-1px);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    text-decoration: none;
    color: white;
}

.btn-outline {
    background: transparent;
    color: #b39ddb;
    border: 1px solid #b39ddb;
}

.btn-outline:hover {
    background: rgba(179, 157, 219, 0.1);
    text-decoration: none;
    color: #b39ddb;
}

.help-text {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.25rem;
}

.error-list {
    margin: 0;
    padding: 0;
    list-style: none;
}

.error-list li {
    color: #ef4444;
    font-size: 0.75rem;
    margin-top: 0.25rem;
}

.tag-guidelines {
    background: rgba(34, 197, 94, 0.05);
    border: 1px solid rgba(34, 197, 94, 0.1);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.tag-guidelines-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #22c55e;
    font-weight: 500;
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
}

.tag-guidelines ul {
    margin: 0;
    padding-left: 1.25rem;
    color: #d1d5db;
    font-size: 0.875rem;
    line-height: 1.5;
}

.tag-guidelines li {
    margin-bottom: 0.25rem;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .tag-type-selector {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .form-actions-left,
    .form-actions-right {
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block admin_content %}
<div class="learning-form-container">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-white mb-2">
            {% if object %}Edit Knowledge Tag{% else %}Create Knowledge Tag{% endif %}
        </h1>
        <p class="text-gray-400">
            {% if object %}Update this knowledge tag to better organize your discoveries{% else %}Create a knowledge tag to organize and categorize your learning discoveries{% endif %}
        </p>
    </div>

    <form method="post" enctype="multipart/form-data" id="tag-form">
        {% csrf_token %}
        
        <!-- Tag Identity Section -->
        <div class="form-section">
            <div class="form-section-header">
                <i class="fas fa-hashtag text-purple-400"></i>
                <div>
                    <h3 class="form-section-title">Tag Identity</h3>
                    <p class="form-section-subtitle">Define your knowledge tag for organizing discoveries</p>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-field">
                    <label class="form-label">
                        <i class="fas fa-tag"></i>
                        Tag Name
                    </label>
                    {% render_field form.name class="form-input" placeholder="e.g., python, api-design, machine-learning" %}
                    {% if form.name.errors %}
                        <ul class="error-list">
                            {% for error in form.name.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <div class="help-text">Concise, lowercase, use hyphens for multi-word tags</div>
                </div>
                
                <div class="form-field">
                    <label class="form-label">
                        <i class="fas fa-link"></i>
                        URL Slug
                    </label>
                    {% render_field form.slug class="form-input" placeholder="auto-generated-from-name" %}
                    <div class="help-text">URL-friendly version (auto-generated if left blank)</div>
                </div>
            </div>
        </div>

        <!-- Tag Type & Purpose Section -->
         <!-- Could be used to link tags to tech, skills, etc.  -->
        <div class="form-section">
            <div class="form-section-header">
                <i class="fas fa-bullseye text-teal-400"></i>
                <div>
                    <h3 class="form-section-title">Tag Type & Purpose (IN DEVELOPMENT)</h3>
                    <p class="form-section-subtitle">Choose the type of knowledge this tag represents</p>
                </div>
            </div>
            
            <div class="tag-type-selector">
                <div class="tag-type-option" data-type="technical">
                    <i class="fas fa-code tag-type-icon text-green-400"></i>
                    <div class="tag-type-title">Technical</div>
                    <div class="tag-type-desc">Programming languages, frameworks, tools</div>
                </div>
                
                <div class="tag-type-option" data-type="conceptual">
                    <i class="fas fa-brain tag-type-icon text-blue-400"></i>
                    <div class="tag-type-title">Conceptual</div>
                    <div class="tag-type-desc">Theories, patterns, methodologies</div>
                </div>
                
                <div class="tag-type-option" data-type="topic">
                    <i class="fas fa-bookmark tag-type-icon text-yellow-400"></i>
                    <div class="tag-type-title">Topic</div>
                    <div class="tag-type-desc">Subject areas, domains, categories</div>
                </div>
                
                <div class="tag-type-option" data-type="skill">
                    <i class="fas fa-medal tag-type-icon text-purple-400"></i>
                    <div class="tag-type-title">Skill</div>
                    <div class="tag-type-desc">Abilities, competencies, practices</div>
                </div>
                
                <div class="tag-type-option" data-type="tool">
                    <i class="fas fa-wrench tag-type-icon text-lavender-400"></i>
                    <div class="tag-type-title">Tool</div>
                    <div class="tag-type-desc">Software, libraries, platforms</div>
                </div>
            </div>
            
            <div class="help-text">Select the type that best describes this tag to help with organization and discovery</div>
        </div>

        <!-- Quick Tag Suggestions -->
        <div class="form-section">
            <div class="form-section-header">
                <i class="fas fa-magic text-mint-400"></i>
                <div>
                    <h3 class="form-section-title">Popular Tag Patterns</h3>
                    <p class="form-section-subtitle">Click to inspire your tag naming</p>
                </div>
            </div>
            
            <div class="tag-suggestions">
                <!-- Technical Tags -->
                <span class="tag-suggestion" data-suggestion="python">python</span>
                <span class="tag-suggestion" data-suggestion="javascript">javascript</span>
                <span class="tag-suggestion" data-suggestion="react">react</span>
                <span class="tag-suggestion" data-suggestion="django">django</span>
                <span class="tag-suggestion" data-suggestion="api-design">api-design</span>
                <span class="tag-suggestion" data-suggestion="database">database</span>
                
                <!-- Conceptual Tags -->
                <span class="tag-suggestion" data-suggestion="design-patterns">design-patterns</span>
                <span class="tag-suggestion" data-suggestion="architecture">architecture</span>
                <span class="tag-suggestion" data-suggestion="testing">testing</span>
                <span class="tag-suggestion" data-suggestion="performance">performance</span>
                <span class="tag-suggestion" data-suggestion="security">security</span>
                <span class="tag-suggestion" data-suggestion="best-practices">best-practices</span>
                
                <!-- Learning Tags -->
                <span class="tag-suggestion" data-suggestion="tutorial">tutorial</span>
                <span class="tag-suggestion" data-suggestion="deep-dive">deep-dive</span>
                <span class="tag-suggestion" data-suggestion="quick-tip">quick-tip</span>
                <span class="tag-suggestion" data-suggestion="troubleshooting">troubleshooting</span>
                <span class="tag-suggestion" data-suggestion="retrospective">retrospective</span>
            </div>
        </div>

        <!-- Tag Preview -->
        <div class="tag-preview">
            <div class="tag-preview-header">
                <i class="fas fa-eye"></i>
                Tag Preview
            </div>
            <div id="tag-display-preview">
                <span class="tag-display technical" id="preview-tag">
                    <i class="fas fa-hashtag"></i>
                    <span id="preview-name">your-tag-name</span>
                </span>
            </div>
            <div style="margin-top: 0.75rem; color: #9ca3af; font-size: 0.875rem;">
                URL: <span style="color: #b39ddb;">/datalog/tag/<span id="preview-slug">your-tag-name</span>/</span>
            </div>
        </div>

        <!-- Tag Statistics (if editing) -->
        {% if object %}
        <div class="form-section">
            <div class="form-section-header">
                <i class="fas fa-chart-bar text-coral-400"></i>
                <div>
                    <h3 class="form-section-title">Tag Usage Statistics</h3>
                    <p class="form-section-subtitle">How this tag is being used across your discoveries</p>
                </div>
            </div>
            
            <div class="tag-stats">
                <div class="stat-card">
                    <span class="stat-number">{{ tag_total_posts|default:"0" }}</span>
                    <div class="stat-label">Total Discoveries</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ tag_published_posts|default:"0" }}</span>
                    <div class="stat-label">Published</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{% if tag_first_post %}{{ tag_first_post.created_at|date:"M Y" }}{% else %}—{% endif %}</span>
                    <div class="stat-label">First Used</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{% widthratio tag_published_posts tag_total_posts 100|default:"0" %}%</span>
                    <div class="stat-label">Publish Rate</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Tag Guidelines -->
        <div class="tag-guidelines">
            <div class="tag-guidelines-header">
                <i class="fas fa-lightbulb"></i>
                Effective Knowledge Tag Guidelines
            </div>
            <ul>
                <li><strong>Be Specific:</strong> Use precise terms that clearly identify the knowledge area</li>
                <li><strong>Stay Consistent:</strong> Use the same tag across related discoveries for better organization</li>
                <li><strong>Use Hierarchies:</strong> Combine general and specific tags (e.g., 'python' + 'django')</li>
                <li><strong>Think Discovery:</strong> Tags should help you and others find related learning content</li>
                <li><strong>Avoid Duplication:</strong> Check existing tags before creating similar ones</li>
                <li><strong>Consider Searchability:</strong> Use terms people would naturally search for</li>
            </ul>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <div class="form-actions-left">
                <a href="{% url 'aura_admin:blog:tag_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    Back to Tags
                </a>
            </div>
            <div class="form-actions-right">
                {% if object %}
                    <a href="{% url 'aura_admin:blog:post_list' %}?tag={{ object.slug }}" class="btn btn-outline">
                        <i class="fas fa-eye"></i>
                        View Tagged Discoveries
                    </a>
                {% endif %}
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-{% if object %}save{% else %}plus{% endif %}"></i>
                    {% if object %}Update Tag{% else %}Create Tag{% endif %}
                </button>
            </div>
        </div>
    </form>

</div>
{% endblock %}

{% block admin_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form elements
    const nameInput = document.getElementById('{{ form.name.id_for_label }}');
    const slugInput = document.getElementById('{{ form.slug.id_for_label }}');
    
    // Preview elements
    const previewName = document.getElementById('preview-name');
    const previewSlug = document.getElementById('preview-slug');
    const previewTag = document.getElementById('preview-tag');
    
    // Tag type options
    const tagTypeOptions = document.querySelectorAll('.tag-type-option');
    let selectedTagType = 'technical'; // default
    
    // Tag suggestions
    const tagSuggestions = document.querySelectorAll('.tag-suggestion');
    
    // Update preview in real-time
    function updatePreview() {
        const name = nameInput.value.trim() || 'your-tag-name';
        const slug = slugInput.value.trim() || name.toLowerCase().replace(/\s+/g, '-');
        
        previewName.textContent = name;
        previewSlug.textContent = slug;
        
        // Update tag display style based on selected type
        previewTag.className = `tag-display ${selectedTagType}`;
        
        // Update icon based on tag type
        const icon = previewTag.querySelector('i');
        switch(selectedTagType) {
            case 'technical':
                icon.className = 'fas fa-code';
                break;
            case 'conceptual':
                icon.className = 'fas fa-brain';
                break;
            case 'topic':
                icon.className = 'fas fa-bookmark';
                break;
            case 'skill':
                icon.className = 'fas fa-medal';
                break;
            case 'tool':
                icon.className = 'fas fa-wrench';
                break;
            default:
                icon.className = 'fas fa-hashtag';
        }
    }
    
    // Auto-generate slug from name
    function generateSlug() {
        // Auto-generate slug from name (robust logic)
        if (nameInput && slugInput) {
            nameInput.addEventListener('input', function() {
                // Only auto-generate if slug hasn't been manually modified
                if (!slugInput.dataset.modified) {
                    const slug = this.value
                        .toLowerCase()
                        .replace(/[^a-z0-9\s-]/g, '')  // Remove special chars but keep spaces and hyphens
                        .replace(/\s+/g, '-')          // Replace spaces with hyphens
                        .replace(/-+/g, '-')           // Replace multiple hyphens with single
                        .replace(/^-+|-+$/g, '');      // Remove leading/trailing hyphens
                    slugInput.value = slug;
                }
                updatePreview();
            });
        }
    }
    
    // Event listeners
    nameInput?.addEventListener('input', function() {
        updatePreview();
        generateSlug();
    });
    
    slugInput?.addEventListener('input', function() {
        // Mark as manually modified to prevent auto-generation
        this.dataset.modified = 'true';
        updatePreview();
    });
    
    // Tag type selection
    tagTypeOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove selected class from all options
            tagTypeOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Add selected class to clicked option
            this.classList.add('selected');
            
            // Update selected tag type
            selectedTagType = this.dataset.type;
            
            // Update preview
            updatePreview();
        });
    });
    
    // Tag suggestions
    tagSuggestions.forEach(suggestion => {
        suggestion.addEventListener('click', function() {
            const suggestionText = this.dataset.suggestion;
            nameInput.value = suggestionText;
            slugInput.value = suggestionText;
            updatePreview();
            
            // Scroll to name input
            nameInput.focus();
            nameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
    });
    
    // Set default selected tag type
    if (tagTypeOptions.length > 0) {
        tagTypeOptions[0].classList.add('selected');
    }
    
    // Initial preview update
    updatePreview();
    
    // Form validation
    const form = document.getElementById('tag-form');
    form?.addEventListener('submit', function(e) {
        const name = nameInput.value.trim();
        
        if (!name) {
            e.preventDefault();
            alert('Please enter a tag name.');
            nameInput.focus();
            return false;
        }
        
        // Ensure slug is set
        if (!slugInput.value.trim()) {
            generateSlug();
        }
    });
});
</script>
{% endblock %}