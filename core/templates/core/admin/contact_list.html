<!-- 
  * core/templates/core/admin/contact_list.html
  * Contact Management Interface
  * Version 1.0 - Matches AURA admin styling patterns
  -->
  {% extends 'admin/admin_base.html' %}
  {% load static %}
  
  {% block admin_title %}Manage Contacts{% endblock %}
  
  {% block admin_css %}
  {{ block.super }}
  <style>
  .admin-nav-link.active {
      background: rgba(var(--emerald-rgb), 0.2);
      color: var(--emerald);
  }
  .contact-card {
      transition: all 0.3s ease;
  }
  .contact-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(52, 211, 153, 0.15);
  }
  .priority-high { border-left: 4px solid #f59e0b; }
  .priority-urgent { border-left: 4px solid #ef4444; }
  .unread-indicator { background: #ef4444; }
  .read-indicator { background: #10b981; }
  </style>
  {% endblock %}
  
  {% block admin_content %}
  <div class="space-y-6">
      
      <!-- Page Header -->
      <div class="flex items-center justify-between">
          <div>
              <h1 class="text-2xl font-bold text-white mb-2">
                  <i class="fas fa-envelope text-emerald-400 mr-3"></i>
                  Portfolio Contacts
              </h1>
              <p class="text-gray-400">{{ subtitle }}</p>
          </div>
          <div class="flex items-center space-x-3">
              <a href="{% url 'aura_admin:contact_create' %}" class="btn btn-emerald">
                  <i class="fas fa-plus mr-2"></i>
                  Add Contact
              </a>
          </div>
      </div>
  
      <!-- Stats Bar -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="glass-card p-4 text-center border-l-4 border-emerald-400">
              <div class="text-2xl font-bold text-emerald-400">{{ total_count }}</div>
              <div class="text-sm text-gray-400">Total Contacts</div>
          </div>
          <div class="glass-card p-4 text-center border-l-4 border-red-400">
              <div class="text-2xl font-bold text-red-400">{{ unread_count }}</div>
              <div class="text-sm text-gray-400">Unread</div>
          </div>
          <div class="glass-card p-4 text-center border-l-4 border-yellow-400">
              <div class="text-2xl font-bold text-yellow-400">{{ filtered_count }}</div>
              <div class="text-sm text-gray-400">Filtered Results</div>
          </div>
          <div class="glass-card p-4 text-center border-l-4 border-orange-400">
              <div class="text-2xl font-bold text-orange-400">
                  {% for contact in contacts %}
                      {% if contact.priority == 'high' or contact.priority == 'urgent' %}1{% endif %}
                  {% empty %}0{% endfor %}
              </div>
              <div class="text-sm text-gray-400">High Priority</div>
          </div>
      </div>
  
      <!-- Filters & Search -->
      <div class="glass-card p-6">
          <form method="GET" class="space-y-4" id="filterForm">
              <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
                  
                  <!-- Search -->
                  <div class="lg:col-span-2">
                      <label class="block text-sm font-medium text-gray-400 mb-1">Search Contacts</label>
                      <div class="relative">
                          <input 
                              type="text" 
                              name="search" 
                              value="{{ search_query }}"
                              placeholder="Search name, email, subject..." 
                              class="form-control pl-10"
                          >
                          <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                      </div>
                  </div>
  
                  <!-- Read Status Filter -->
                  <div>
                      <label class="block text-sm font-medium text-gray-400 mb-1">Read Status</label>
                      <select name="read_status" class="form-control">
                          <option value="">All Messages</option>
                          <option value="unread" {% if request.GET.read_status == 'unread' %}selected{% endif %}>Unread Only</option>
                          <option value="read" {% if request.GET.read_status == 'read' %}selected{% endif %}>Read Only</option>
                      </select>
                  </div>
  
                  <!-- Category Filter -->
                  <div>
                      <label class="block text-sm font-medium text-gray-400 mb-1">Category</label>
                      <select name="category" class="form-control">
                          <option value="">All Categories</option>
                          {% for value, label in inquiry_categories %}
                              <option value="{{ value }}" {% if request.GET.category == value %}selected{% endif %}>{{ label }}</option>
                          {% endfor %}
                      </select>
                  </div>
  
                  <!-- Priority Filter -->
                  <div>
                      <label class="block text-sm font-medium text-gray-400 mb-1">Priority</label>
                      <select name="priority" class="form-control">
                          <option value="">All Priorities</option>
                          {% for value, label in priority_levels %}
                              <option value="{{ value }}" {% if request.GET.priority == value %}selected{% endif %}>{{ label }}</option>
                          {% endfor %}
                      </select>
                  </div>
              </div>
  
              <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                      <button type="submit" class="btn btn-emerald">
                          <i class="fas fa-filter mr-2"></i>
                          Apply Filters
                      </button>
                      <a href="{% url 'aura_admin:contact_list' %}" class="btn btn-outline">
                          <i class="fas fa-times mr-2"></i>
                          Clear
                      </a>
                  </div>
                  
                  <!-- Bulk Actions -->
                  <div class="flex items-center space-x-2">
                      <select id="bulkAction" class="form-control w-auto">
                          <option value="">Bulk Actions</option>
                          <option value="mark_read">Mark as Read</option>
                          <option value="mark_unread">Mark as Unread</option>
                          <option value="set_priority_high">Set High Priority</option>
                          <option value="set_priority_normal">Set Normal Priority</option>
                          <option value="delete">Delete Selected</option>
                      </select>
                      <button type="button" id="applyBulkAction" class="btn btn-orange">
                          Apply
                      </button>
                  </div>
              </div>
          </form>
      </div>
  
      <!-- Contact List -->
      <div class="space-y-4">
          {% if contacts %}
              {% for contact in contacts %}
                  <div class="glass-card contact-card p-6 {% if contact.priority == 'high' %}priority-high{% elif contact.priority == 'urgent' %}priority-urgent{% endif %}">
                      <div class="flex items-center justify-between">
                          <!-- Contact Info -->
                          <div class="flex items-start space-x-4 flex-1">
                              <!-- Checkbox -->
                              <input type="checkbox" class="contact-checkbox mt-2" value="{{ contact.pk }}">
                              
                              <!-- Status Indicator -->
                              <div class="mt-2">
                                  <div class="w-3 h-3 rounded-full {% if contact.is_read %}read-indicator{% else %}unread-indicator{% endif %}"></div>
                              </div>
                              
                              <!-- Contact Details -->
                              <div class="flex-1">
                                  <div class="flex items-center space-x-3 mb-2">
                                      <h3 class="text-lg font-bold text-white">{{ contact.name }}</h3>
                                      
                                      <!-- Priority Badge -->
                                      {% if contact.priority == 'high' %}
                                          <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded-full">
                                              <i class="fas fa-exclamation-triangle mr-1"></i>High Priority
                                          </span>
                                      {% elif contact.priority == 'urgent' %}
                                          <span class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full">
                                              <i class="fas fa-exclamation-circle mr-1"></i>Urgent
                                          </span>
                                      {% endif %}
                                      
                                      <!-- Category Badge -->
                                      <span class="px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full">
                                          {{ contact.get_inquiry_category_display }}
                                      </span>
                                      
                                      <!-- Response Status -->
                                      {% if contact.response_sent %}
                                          <span class="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded-full">
                                              <i class="fas fa-check mr-1"></i>Responded
                                          </span>
                                      {% else %}
                                          <span class="px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded-full">
                                              <i class="fas fa-clock mr-1"></i>Pending Response
                                          </span>
                                      {% endif %}
                                  </div>
                                  
                                  <div class="text-sm text-gray-400 mb-1">
                                      <i class="fas fa-envelope mr-1"></i>{{ contact.email }}
                                  </div>
                                  
                                  <div class="text-white font-medium mb-2">{{ contact.subject }}</div>
                                  
                                  <div class="text-gray-400 text-sm mb-3">
                                      {{ contact.message|truncatechars:150 }}
                                  </div>
                                  
                                  <div class="flex items-center space-x-4 text-xs text-gray-500">
                                      <span>
                                          <i class="fas fa-calendar mr-1"></i>
                                          {{ contact.created_at|date:"M d, Y g:i A" }}
                                      </span>
                                      {% if contact.referrer_page %}
                                          <span>
                                              <i class="fas fa-link mr-1"></i>
                                              From: {{ contact.referrer_page|truncatechars:30 }}
                                          </span>
                                      {% endif %}
                                      {% if contact.response_date %}
                                          <span class="text-green-400">
                                              <i class="fas fa-reply mr-1"></i>
                                              Responded {{ contact.response_date|timesince }} ago
                                          </span>
                                      {% endif %}
                                  </div>
                              </div>
                          </div>
                          
                          <!-- Actions -->
                          <div class="flex items-center space-x-2 ml-4">
                              <!-- Quick Actions -->
                              {% if not contact.is_read %}
                                  <button 
                                      class="btn btn-xs btn-emerald mark-read-btn" 
                                      data-contact-id="{{ contact.pk }}"
                                      title="Mark as Read"
                                  >
                                      <i class="fas fa-eye"></i>
                                  </button>
                              {% endif %}
                              
                              {% if not contact.response_sent %}
                                  <button 
                                      class="btn btn-xs btn-blue mark-response-btn" 
                                      data-contact-id="{{ contact.pk }}"
                                      title="Mark Response Sent"
                                  >
                                      <i class="fas fa-reply"></i>
                                  </button>
                              {% endif %}
                              
                              <!-- Main Actions -->
                              <a href="{% url 'aura_admin:contact_update' contact.pk %}" class="btn btn-xs btn-outline" title="Edit Contact">
                                  <i class="fas fa-edit"></i>
                              </a>
                              
                              <a href="{% url 'aura_admin:contact_delete' contact.pk %}" class="btn btn-xs btn-red" title="Delete Contact">
                                  <i class="fas fa-trash"></i>
                              </a>
                          </div>
                      </div>
                  </div>
              {% endfor %}
          {% else %}
              <!-- Empty State -->
              <div class="glass-card p-12 text-center">
                  <div class="text-gray-400">
                      <i class="fas fa-inbox text-4xl mb-4"></i>
                      <h3 class="text-xl font-bold mb-2">No Contacts Found</h3>
                      {% if search_query or request.GET.read_status or request.GET.category or request.GET.priority %}
                          <p class="mb-4">No contacts match your current filters.</p>
                          <a href="{% url 'aura_admin:contact_list' %}" class="btn btn-emerald">
                              <i class="fas fa-times mr-2"></i>
                              Clear Filters
                          </a>
                      {% else %}
                          <p class="mb-4">You haven't received any portfolio contact submissions yet.</p>
                          <a href="{% url 'aura_admin:contact_create' %}" class="btn btn-emerald">
                              <i class="fas fa-plus mr-2"></i>
                              Add Test Contact
                          </a>
                      {% endif %}
                  </div>
              </div>
          {% endif %}
      </div>
  
      <!-- Pagination -->
      {% if is_paginated %}
          <div class="flex justify-center">
              <nav class="pagination-nav">
                  <div class="flex items-center space-x-2">
                      {% if page_obj.has_previous %}
                          <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if request.GET.read_status %}&read_status={{ request.GET.read_status }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}" class="btn btn-xs btn-outline">
                              <i class="fas fa-angle-double-left"></i>
                          </a>
                          <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if request.GET.read_status %}&read_status={{ request.GET.read_status }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}" class="btn btn-xs btn-outline">
                              <i class="fas fa-angle-left mr-1"></i>Previous
                          </a>
                      {% endif %}
                      
                      <span class="px-4 py-2 text-sm text-gray-400">
                          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                      </span>
                      
                      {% if page_obj.has_next %}
                          <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if request.GET.read_status %}&read_status={{ request.GET.read_status }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}" class="btn btn-xs btn-outline">
                              Next<i class="fas fa-angle-right ml-1"></i>
                          </a>
                          <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if request.GET.read_status %}&read_status={{ request.GET.read_status }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}" class="btn btn-xs btn-outline">
                              <i class="fas fa-angle-double-right"></i>
                          </a>
                      {% endif %}
                  </div>
              </nav>
          </div>
      {% endif %}
  
  </div>
  
  <!-- AJAX Scripts -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
      // Mark as Read functionality
      document.querySelectorAll('.mark-read-btn').forEach(btn => {
          btn.addEventListener('click', function() {
              const contactId = this.dataset.contactId;
              
              fetch(`{% url 'aura_admin:contact_mark_read' 0 %}`.replace('0', contactId), {
                  method: 'POST',
                  headers: {
                      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                      'Content-Type': 'application/json',
                  },
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // Update UI to show as read
                      const card = this.closest('.contact-card');
                      const indicator = card.querySelector('.unread-indicator');
                      if (indicator) {
                          indicator.className = 'w-3 h-3 rounded-full read-indicator';
                      }
                      this.remove(); // Remove the mark-as-read button
                      
                      // Show success message
                      showNotification(data.message, 'success');
                  }
              })
              .catch(error => {
                  showNotification('Error marking contact as read', 'error');
              });
          });
      });
  
      // Mark Response Sent functionality
      document.querySelectorAll('.mark-response-btn').forEach(btn => {
          btn.addEventListener('click', function() {
              const contactId = this.dataset.contactId;
              
              fetch(`{% url 'aura_admin:contact_mark_response_sent' 0 %}`.replace('0', contactId), {
                  method: 'POST',
                  headers: {
                      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                      'Content-Type': 'application/json',
                  },
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // Update UI to show as responded
                      const card = this.closest('.contact-card');
                      // You could update badges here
                      this.remove(); // Remove the response button
                      
                      // Show success message
                      showNotification(data.message, 'success');
                  }
              })
              .catch(error => {
                  showNotification('Error marking response as sent', 'error');
              });
          });
      });
  
      // Bulk Actions
      document.getElementById('applyBulkAction').addEventListener('click', function() {
          const action = document.getElementById('bulkAction').value;
          const selectedContacts = Array.from(document.querySelectorAll('.contact-checkbox:checked'))
              .map(cb => cb.value);
          
          if (!action) {
              showNotification('Please select an action', 'warning');
              return;
          }
          
          if (selectedContacts.length === 0) {
              showNotification('Please select contacts to perform action on', 'warning');
              return;
          }
          
          if (action === 'delete' && !confirm('Are you sure you want to delete the selected contacts?')) {
              return;
          }
          
          // Implement bulk action logic here
          showNotification(`${action} applied to ${selectedContacts.length} contacts`, 'info');
      });
  
      // Select All functionality
      const selectAllCheckbox = document.getElementById('selectAll');
      if (selectAllCheckbox) {
          selectAllCheckbox.addEventListener('change', function() {
              document.querySelectorAll('.contact-checkbox').forEach(cb => {
                  cb.checked = this.checked;
              });
          });
      }
  });
  
  // Notification helper function
  function showNotification(message, type) {
      // Create a simple notification
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
          type === 'success' ? 'bg-green-500' :
          type === 'error' ? 'bg-red-500' :
          type === 'warning' ? 'bg-yellow-500' :
          'bg-blue-500'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
          notification.remove();
      }, 3000);
  }
  </script>
  
  {% endblock %}