{% for system in systems %}
<article class="system-card learning-card {{ system.learning_stage }}">
        
        <!-- Card Header -->
        <header class="system-card-header">
            <div class="system-card-badges">
                <span class="system-id-badge">{{ system.system_id }}</span>
                
                {% comment %} <!-- Learning Stage Badge -->
                <div class="learning-stage-badge learning-stage-{{ system.learning_stage }}">
                    <span class="stage-dot"></span>
                    {{ system.get_learning_stage_display }}
                </div> {% endcomment %}

                {% comment %} <!-- GitHub Activity Indicator -->
                {% if system.commit_stats.repository_count > 0 %}
                <span class="activity-indicator" 
                    style="background-color: {{ system.github_activity_level.color }}"
                    title="{{ system.github_activity_level.label }}">
                    <i class="fab fa-github"></i>
                </span>
                {% endif %} {% endcomment %}

                <!-- Complexity Indicator (replaces portfolio-ready badge) -->
                <div class="complexity-indicator" title="Complexity: {{ system.complexity|default:1 }}/5" data-complexity="{{ system.complexity|default:1 }}">
                    <div class="complexity-bars">
                        {% with complexity=system.complexity|default:1 %}
                        {% for i in "12345" %}
                            <div class="complexity-bar {% if complexity >= forloop.counter %}filled{% endif %}"></div>
                        {% endfor %}
                        {% endwith %}
                    </div>
                    <span class="complexity-label">{{ system.complexity|default:1 }}/5</span>
                </div>
                
            </div>
            
            <h3 class="system-card-title">{{ system.title }}</h3>
            {% if system.system_type %}
            <p class="system-card-subtitle">
                <i class="fas fa-{{ system.system_type.icon|default:'apps' }}"></i> 
                {{ system.system_type.name }}
            </p>
            {% endif %}
            <!-- Learning Stage Badge -->
            <div class="learning-stage-badge learning-stage-{{ system.learning_stage }}">
                {{ system.get_learning_stage_display }}
            </div>
        </header>

        <!-- Card Body -->
        <div class="system-card-body">
            {% if system.excerpt %}
            <p class="system-card-excerpt">{{ system.excerpt|truncatewords:25 }}</p>
            {% endif %}

             <!-- Real GitHub Metrics (Enhanced) -->
    <div class="github-metrics">
        <h4><i class="fab fa-github"></i> Development Activity</h4>
        
        {% if system.commit_stats.repository_count > 0 %}
        <div class="metrics-grid">
            <!-- Total Commits (Real Data) -->
            <div class="metric-item">
                <span class="metric-value">{{ system.commit_stats.total_commits }}</span>
                <span class="metric-label">Total Commits</span>
            </div>
            
            <!-- Recent Activity (Real Data) -->
            <div class="metric-item">
                <span class="metric-value" style="color: {{ system.github_activity_level.color }}">
                    {{ system.commit_stats.commits_last_30_days }}
                </span>
                <span class="metric-label">Commits - 30 days</span>
            </div>
            
            <!-- Repository Count -->
            <div class="metric-item">
                <span class="metric-value">{{ system.commit_stats.repository_count }}</span>
                <span class="metric-label">Repositories</span>
            </div>
            
            <!-- Complexity Score (Now with Real GitHub Data) -->
            <div class="metric-item">
                <span class="metric-value">{{ system.real_complexity_score }}/20</span>
                <span class="metric-label">Complexity Score</span>
            </div>
        </div>

        <!-- Development Trend (if weekly data available) -->
        {% if system.commit_stats.weekly_analysis %}
        <div class="development-trend">
            <span class="trend-label">Recent Trend:</span>
            <span class="trend-indicator trend-{{ system.commit_stats.weekly_analysis.recent_trend.direction }}">
                {% if system.commit_stats.weekly_analysis.recent_trend.direction == 'up' %}
                    <i class="fas fa-arrow-up"></i> {{ system.commit_stats.weekly_analysis.recent_trend.percentage|floatformat:0 }}%
                {% elif system.commit_stats.weekly_analysis.recent_trend.direction == 'down' %}
                    <i class="fas fa-arrow-down"></i> {{ system.commit_stats.weekly_analysis.recent_trend.percentage|floatformat:0 }}%
                {% else %}
                    <i class="fas fa-minus"></i> Stable
                {% endif %}
            </span>
        </div>
        {% endif %}

        {% comment %} <!-- Last Commit Info (Real Data) -->
        {% if system.commit_stats.last_commit_date %}
        <div class="last-commit">
            <small class="text-muted">
                <i class="fas fa-clock"></i>
                Last commit: {{ system.commit_stats.last_commit_date|timesince }} ago
                {% if system.commit_stats.most_active_repo %}
                in {{ system.commit_stats.most_active_repo.name }}
                {% endif %}
            </small>
        </div>
        {% endif %} {% endcomment %}

        {% else %}
        <!-- No GitHub Data -->
        <div class="metrics-grid">
            <!-- Total Commits (Real Data) -->
            <div class="metric-item">
                {% if system.skill_summary.flags.has_proficiency %}
                    {% if system.skill_summary.skill_proficiency.new_skills  %}
                    <span class="metric-value">{{ system.skill_summary.skill_proficiency.new_skills }}</span>
                    <span class="metric-label">Skills Gained</span>
                    {% elif system.skill_summary.skill_proficiency.improved_skills %}
                    <span class="metric-value">{{ system.skill_summary.skill_proficiency.improved_skills }}</span>
                    <span class="metric-label">Skills Improved</span>
                    {% elif system.skill_summary.skill_proficiency.mastered_skills %}
                    <span class="metric-value">{{ system.skill_summary.skill_proficiency.mastered_skills }}</span>
                    <span class="metric-label">Skills Mastered</span>
                    {% else %}
                    <span class="metric-value">{{ system.skills_developed.count }}</span>
                    <span class="metric-label">Skills</span>
                    {% endif %}
                {% endif %}
                
            </div>
            <div class="metric-item">
                {% if system.skill_summary.flags.has_milestones %}
                    {% if system.skill_summary.milestones.major_milestones  %}
                    <span class="metric-value">{{ system.skill_summary.milestones.major_milestones }}</span>
                    <span class="metric-label">Major Milestones</span>
                    {% else %}
                    <span class="metric-value">{{ system.skill_summary.milestones.total_milestones }}</span>
                    <span class="metric-label">Milestones</span>
                    {% endif %}
                {% endif %}
            </div>

            <div class="metric-item">
                <span class="metric-value">
                    {% if system.actual_dev_hours %}
                        {{ system.actual_dev_hours }}h
                    {% elif system.estimated_dev_hours %}
                        ~{{ system.estimated_dev_hours }}h
                    {% else %}
                        0h
                    {% endif %}
                </span>
                <span class="metric-label">Time Invested</span>
            </div>

            <!-- Complexity Score (Now with Real GitHub Data) -->
            <div class="metric-item">
                <span class="metric-value">{{ system.real_complexity_score }}/20</span>
                <span class="metric-label">Complexity Score</span>
            </div>

        </div>
        <div class="no-github-data">
            <i class="fas fa-info-circle"></i>
            <small class="text-muted">Manually tracked data: No GitHub repositories linked</small>
        </div>
        {% endif %}
    </div>

            <!-- Skills Pills -->
            {% if system.skills_developed.all %}
            
            <div class="skills-pills-container">
                <div class="metric-label" style="padding-top: 1rem; padding-bottom: 0.5rem;">
                    Skills
                </div>
                <div class="skills-pills">
                {% for skill in system.skills_developed.all|slice:":4" %}
                <span class="skill-pill">{{ skill.name }}</span>
                {% endfor %}
                {% if system.skills_developed.count > 4 %}
                <span class="skill-pill more">+{{ system.skills_developed.count|add:"-4" }} more</span>
                {% endif %}
                </div>
                
            </div>
            
            {% endif %}

            {% comment %} <!-- Learning Progress Bar -->
            <div class="learning-progress">
                <div class="progress-info">
                    <span>Learning Progress</span>
                    <span>{{ system.completion_percent|default:0 }}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill learning-progress-{{ system.learning_stage }}" 
                         style="width: {{ system.completion_percent|default:0 }}%;"></div>
                </div>
            </div> {% endcomment %}

                        <!-- Technology Stack -->
            {% if system.technologies.all %}
            <div class="tech-stack-container">
                <div class="metric-label" style="padding-top: 1rem; padding-bottom: 0.5rem;">
                    Tech Stack
                </div>
            <div class="tech-stack">
                {% for tech in system.technologies.all|slice:":5" %}
                <span class="tech-tag {{ tech.category|lower }}">{{ tech.name }}</span>
                {% endfor %}
                {% if system.technologies.count > 5 %}
                <span class="tech-tag more">+{{ system.technologies.count|add:"-5" }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
    

        <div class="system-meta">
            <div class="meta-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Last Updated: {{ system.updated_at|date:"M d, Y" }}</span>
            </div>
            <!-- Last Commit Info (Real Data) -->
            {% if system.github_url %}
            <div class="github-info">
                <div class="meta-item">
                    <i class="fab fa-github"></i>
                    <span>{{ system.commit_stats.total_commits|default:0 }} commit{{ system.commit_stats.total_commits|pluralize }}</span>
                </div>
                {% if system.commit_stats.last_commit_date %}
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        Last commit: {{ system.commit_stats.last_commit_date|timesince }} ago
                        {% if system.commit_stats.most_active_repo %}
                        in {{ system.commit_stats.most_active_repo.name }}
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

<!-- Card Footer -->
<footer class="system-card-footer">
    <div class="learning-progress progress-section">
        <div class="progress-info">
            <span>Progress</span>
            <span>{{ system.completion_percent|default:0 }}%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill learning-progress-{{ system.learning_stage }}" 
                 style="width: {{ system.completion_percent|default:0 }}%;"></div>
        </div>
    </div>
    
    <div class="system-actions">
        <a href="{{ system.get_absolute_url }}" class="action-btn primary">
            <i class="fas fa-eye"></i>
            <span>View</span>
        </a>
        {% if system.github_url %}
        <a href="{{ system.github_url }}" target="_blank" class="action-btn">
            <i class="fab fa-github"></i>
        </a>
        {% endif %}
        {% if system.live_url %}
        <a href="{{ system.live_url }}" target="_blank" class="action-btn">
            <i class="fas fa-external-link-alt"></i>
        </a>
        {% endif %}
    </div>
</footer>


        {% comment %} <!-- Card Footer -->
        <footer class="system-card-footer">
            <div class="system-actions">
                <!-- Learning Milestones Indicator -->
                {% if system.milestones.count > 0 %}
                <div class="milestones-indicator">
                    <i class="fas fa-trophy"></i>
                    <span>{{ system.milestones.count }} milestone{{ system.milestones.count|pluralize }}</span>
                </div>
                {% endif %}
                
                <a href="{% url 'projects:system_detail' system.slug %}" class="action-btn primary">
                    <i class="fas fa-terminal"></i>
                    View Learning Details
                </a>
            </div>
        </footer> {% endcomment %}
    </article>
     {% endfor %}