<!----
 * AURA Portfolio - Enhanced System Detail Template
 * Advanced User Repository & Archive - Complete Foundation
 * Version: 3.0.0 - System Interface Dashboard within AURA Framework
---->

{% extends "projects/systems_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}
{% load system_tags %}

{% block systems_title %}{{ system.title }} Interface{% endblock %}
{% block meta_description %}Interactive system dashboard for {{ system.title }} - Complete system overview with metrics, technologies, and development insights{% endblock %}

{% block systems_css %}
<link rel="stylesheet" href="{% static 'projects/css/systems-unified.css' %}">
<link rel="stylesheet" href="{% static 'projects/css/system-detail.css' %}">
{% endblock %}

{% block systems_breadcrumbs %}
<a href="{% url 'projects:system_list' %}" class="breadcrumb-item">
    <i class="fas fa-th-large"></i>
    Systems
</a>
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item active">{{ system.system_id|default:system.slug|upper }}</span>
{% endblock %}

{% block systems_content %}
<div class="system-interface-wrapper">
    <div class="container">
        
        <!-- System Interface Dashboard -->
        <div class="system-interface">
            
            <!-- System Title Bar - Window Controls -->
            <div class="system-title-bar">
                <div class="system-window-controls">
                    <div class="window-control close" title="Close Interface"></div>
                    <div class="window-control minimize" title="Minimize Interface"></div>
                    <div class="window-control maximize" title="Maximize Interface"></div>
                </div>
                
                <div class="system-interface-title">
                    <div class="system-status-indicator"></div>
                    <span>{{ system.title }} - System Interface v{{ system.version|default:"1.0" }}</span>
                </div>
                
                <div class="system-status-info">
                    <span>{{ system.get_status_display|upper }}</span>
                    <span>â€¢</span>
                    <span>{{ system.updated_at|timesince }} ago</span>
                </div>
            </div>
            
            <!-- Interface Navigation Tabs -->
            <div class="interface-nav-tabs">
                <button class="interface-tab active" data-panel="overview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Overview</span>
                </button>
                <button class="interface-tab" data-panel="metrics">
                    <i class="fas fa-chart-line"></i>
                    <span>Metrics</span>
                </button>
                <button class="interface-tab" data-panel="technologies">
                    <i class="fas fa-code"></i>
                    <span>Tech Stack</span>
                </button>
                <button class="interface-tab" data-panel="features">
                    <i class="fas fa-list-check"></i>
                    <span>Features</span>
                </button>
                {% if system.images.exists or gallery_images.exists %}
                <button class="interface-tab" data-panel="gallery">
                    <i class="fas fa-images"></i>
                    <span>Gallery</span>
                </button>
                {% endif %}
                {% if related_datalogs.exists %}
                <button class="interface-tab" data-panel="datalogs">
                    <i class="fas fa-file-alt"></i>
                    <span>DataLogs</span>
                </button>
                {% endif %}
                {% if system.dependencies.exists or system.dependents.exists %}
                <button class="interface-tab" data-panel="dependencies">
                    <i class="fas fa-project-diagram"></i>
                    <span>Dependencies</span>
                </button>
                {% endif %}
                <button class="interface-tab" data-panel="terminal">
                    <i class="fas fa-terminal"></i>
                    <span>Console</span>
                </button>
            </div>
            
            <!-- Interface Content -->
            <div class="interface-content">
                
                <!-- ðŸ“Š Overview Panel -->
                <div class="interface-panel active" id="overview-panel">
                    
                    <!-- System Hero Metrics -->
                    <div class="system-metrics-grid">
                        {% if system.completion_percent %}
                        <div class="metric-display">
                            <div class="metric-value">{{ system.completion_percent }}%</div>
                            <div class="metric-label">Completion</div>
                            <div class="metric-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>Active</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="metric-display">
                            <div class="metric-value">
                                {% if system.performance_score %}
                                    {% if system.performance_score >= 90 %}Excellent
                                    {% elif system.performance_score >= 75 %}Good
                                    {% elif system.performance_score >= 60 %}Fair
                                    {% else %}Poor{% endif %}
                                {% else %}Healthy{% endif %}
                            </div>
                            <div class="metric-label">Health Status</div>
                            <div class="metric-trend trend-up">
                                <i class="fas fa-heart"></i>
                                <span>{{ system.updated_at|timesince }} ago</span>
                            </div>
                        </div>
                        
                        {% if system.technologies.exists %}
                        <div class="metric-display">
                            <div class="metric-value">{{ system.technologies.count }}</div>
                            <div class="metric-label">Technologies</div>
                            <div class="metric-trend trend-neutral">
                                <i class="fas fa-code"></i>
                                <span>Stack</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Team & Collaboration Metrics - Using actual and placeholder data -->
                        <div class="metric-display">
                            <div class="metric-value">{{ system.team_size|default:"1" }}</div>
                            <div class="metric-label">Team Size</div>
                            <div class="metric-trend">
                                <i class="fas fa-users"></i>
                                <span>Active</span>
                            </div>
                        </div>
                        
                        <!-- Placeholder: Contributors Count (Future Enhancement) -->
                        <div class="metric-display">
                            <div class="metric-value">{{ system.team_size|default:"1" }}+</div>
                            <div class="metric-label">Contributors</div>
                            <div class="metric-trend trend-neutral">
                                <i class="fas fa-user-friends"></i>
                                <span>Estimated</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Information -->
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>
                                <span>System Information</span>
                            </div>
                            <div class="section-actions">
                                {% if system.live_url %}
                                <a href="{{ system.live_url }}" target="_blank" class="section-action-btn">
                                    <i class="fas fa-external-link-alt"></i>
                                    Launch
                                </a>
                                {% endif %}
                                {% if system.github_url %}
                                <a href="{{ system.github_url }}" target="_blank" class="section-action-btn">
                                    <i class="fab fa-github"></i>
                                    Source
                                </a>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="systems-unified-container dashboard compact">
                            <div class="systems-content-grid">
                                <div class="systems-content-info" style="grid-column: 1 / -1;">
                                    <div class="system-description-content">
                                        {{ system.description|markdownify|default:"<p>No description available for this system.</p>" }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- ðŸ“ˆ Metrics Panel -->
                <div class="interface-panel" id="metrics-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-chart-line"></i>
                                <span>Performance Metrics</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn" onclick="refreshMetrics()">
                                    <i class="fas fa-sync-alt"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="interactive-grid">
                            {% if system.metrics.exists %}
                                {% for metric in system.metrics.all %}
                                <div class="interactive-card">
                                    <div class="card-header">
                                        <div class="card-icon">
                                            <i class="fas fa-chart-bar"></i>
                                        </div>
                                        <div>
                                            <h3 class="card-title">{{ metric.metric_name }}</h3>
                                            <p class="card-subtitle">{{ metric.get_metric_type_display }}</p>
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <button class="card-action">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="card-action">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                    <div style="text-align: center; margin-top: var(--spacing-md);">
                                        <div style="font-size: 2rem; font-weight: 700; color: var(--color-teal);">
                                            {{ metric.value }}{{ metric.unit|default:"" }}
                                        </div>
                                        <div style="color: var(--color-text-secondary);">
                                            {{ metric.recorded_at|date:"M d, Y" }}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                            <!-- Placeholder Metrics for Demo -->
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-tachometer-alt"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Performance Score</h3>
                                        <p class="card-subtitle">Overall system performance</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-chart-bar"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-info"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-success);">
                                        {{ system.performance_score|default:"94" }}%
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        Excellent Rating
                                    </div>
                                </div>
                            </div>
                            
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Response Time</h3>
                                        <p class="card-subtitle">Average API response time</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-history"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-teal);">
                                        {{ system.response_time_ms|default:"157" }}ms
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        Fast Response
                                    </div>
                                </div>
                            </div>
                            
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Active Users</h3>
                                        <p class="card-subtitle">Daily active user count</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-chart-line"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-export"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-warning);">
                                        {{ system.daily_users|default:"1,247" }}
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        This Month
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Placeholder: Code Quality Metrics (Future Enhancement) -->
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-code-branch"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Code Quality</h3>
                                        <p class="card-subtitle">Code review coverage & quality</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-microscope"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-shield-alt"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-success);">
                                        {% if system.commit_count and system.commit_count > 50 %}A+{% elif system.commit_count and system.commit_count > 20 %}A{% else %}B+{% endif %}
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        Quality Score
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Placeholder: Collaboration Score (Future Enhancement) -->
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-handshake"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Collaboration</h3>
                                        <p class="card-subtitle">Team collaboration effectiveness</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-users-cog"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-comments"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-info);">
                                        {% if system.team_size > 1 %}High{% else %}Solo{% endif %}
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        {{ system.team_size|default:"1" }} Member{{ system.team_size|pluralize }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Placeholder: Monthly Users (Future Enhancement) -->
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-chart-area"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">Monthly Reach</h3>
                                        <p class="card-subtitle">Monthly active users & growth</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-trending-up"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-calendar-alt"></i>
                                    </button>
                                </div>
                                <div style="text-align: center; margin-top: var(--spacing-md);">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--color-purple);">
                                        {% if system.daily_users %}{{ system.daily_users|floatformat:0|add:"0000" }}{% else %}5.2K{% endif %}
                                    </div>
                                    <div style="color: var(--color-text-secondary);">
                                        Monthly Users
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- ðŸ’» Technologies Panel -->
                <div class="interface-panel" id="technologies-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-code"></i>
                                <span>Technology Stack</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn">
                                    <i class="fas fa-plus"></i>
                                    Add Tech
                                </button>
                            </div>
                        </div>
                        
                        <div class="interactive-grid">
                            {% for tech in system.technologies.all %}
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon" style="background: rgba({{ tech.color|hex_to_rgb|default:'0, 212, 255' }}, 0.2); color: {{ tech.color|default:'var(--color-teal)' }};">
                                        {% if tech.icon %}
                                        <i class="{{ tech.icon }}"></i>
                                        {% else %}
                                        <i class="fas fa-code"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h3 class="card-title">{{ tech.name }}</h3>
                                        <p class="card-subtitle">{{ tech.get_category_display|title }} â€¢ {{ tech.get_proficiency_level_display|title }}</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-info"></i>
                                    </button>
                                    <button class="card-action" onclick="window.open('{% url 'projects:technology_detail' slug=tech.slug %}', '_blank')">
                                        <i class="fas fa-external-link-alt"></i>
                                    </button>
                                </div>
                                {% if tech.usage_percentage %}
                                <div style="margin-top: var(--spacing-md);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--color-text-secondary);">Usage</span>
                                        <span style="color: {{ tech.color|default:'var(--color-teal)' }};">{{ tech.usage_percentage }}%</span>
                                    </div>
                                    <div class="usage-bar">
                                        <div class="usage-progress" style="background: {{ tech.color|default:'var(--color-teal)' }}; width: {{ tech.usage_percentage }}%;"></div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            {% empty %}
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">No Technologies Listed</h3>
                                        <p class="card-subtitle">Tech stack not documented</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- âš™ï¸ Features Panel -->
                <div class="interface-panel" id="features-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-list-check"></i>
                                <span>System Features</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn" onclick="toggleFeatureView()">
                                    <i class="fas fa-th-list"></i>
                                    Toggle View
                                </button>
                            </div>
                        </div>
                        
                        <div class="interactive-grid">
                            {% for feature in system.features.all %}
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon status-{{ feature.status|lower }}">
                                        {% if feature.status == 'completed' %}
                                        <i class="fas fa-check-circle"></i>
                                        {% elif feature.status == 'in_progress' %}
                                        <i class="fas fa-clock"></i>
                                        {% elif feature.status == 'planned' %}
                                        <i class="fas fa-calendar-plus"></i>
                                        {% else %}
                                        <i class="fas fa-exclamation-triangle"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h3 class="card-title">{{ feature.name }}</h3>
                                        <p class="card-subtitle">{{ feature.get_feature_type_display|title }} Feature</p>
                                    </div>
                                </div>
                                <div style="margin-top: var(--spacing-md);">
                                    {% if feature.description %}
                                    <p style="color: var(--color-text-secondary); font-size: 0.9rem; line-height: 1.4; margin-bottom: var(--spacing-sm);">
                                        {{ feature.description|truncatewords:20 }}
                                    </p>
                                    {% endif %}
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);" class="status-{{ feature.status|lower }}">
                                        {% if feature.status == 'completed' %}
                                        <i class="fas fa-check"></i>
                                        <span>Implemented & Tested</span>
                                        {% elif feature.status == 'in_progress' %}
                                        <i class="fas fa-clock"></i>
                                        <span>In Development</span>
                                        {% elif feature.status == 'planned' %}
                                        <i class="fas fa-calendar-plus"></i>
                                        <span>Planned</span>
                                        {% else %}
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span>Not Started</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="interactive-card">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div>
                                        <h3 class="card-title">No Features Listed</h3>
                                        <p class="card-subtitle">Feature list not documented</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- ðŸ–¼ï¸ Gallery Panel -->
                {% if system.images.exists %}
                <div class="interface-panel" id="gallery-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-images"></i>
                                <span>System Gallery</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn">
                                    <i class="fas fa-upload"></i>
                                    Upload
                                </button>
                                <button class="section-action-btn">
                                    <i class="fas fa-expand"></i>
                                    Fullscreen
                                </button>
                            </div>
                        </div>
                        
                        <div class="gallery-grid">
                            {% for image in system.images.all %}
                            <div class="gallery-item" onclick="openImageModal('{{ image.image.url }}', '{{ image.title }}')">
                                <img src="{{ image.image.url }}" alt="{{ image.title }}">
                                <div class="gallery-info">
                                    <div class="gallery-title">{{ image.title }}</div>
                                    {% if image.description %}
                                    <div class="gallery-description">{{ image.description|truncatewords:15 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- ðŸ“ DataLogs Panel -->
                {% if related_datalogs.exists %}
                <div class="interface-panel" id="datalogs-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-file-alt"></i>
                                <span>Related DataLogs</span>
                            </div>
                            <div class="section-actions">
                                <a href="{% url 'blog:post_create' %}?system={{ system.slug }}" class="section-action-btn">
                                    <i class="fas fa-plus"></i>
                                    New Log
                                </a>
                                <button class="section-action-btn">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="interactive-grid">
                            {% for log_entry in related_datalogs %}
                            <div class="interactive-card" onclick="window.open('{% url 'blog:post_detail' slug=log_entry.post.slug %}', '_blank')">
                                <div class="card-header">
                                    <div class="card-icon" style="background: rgba(179, 157, 219, 0.2); color: #B39DDB;">
                                        {% if log_entry.connection_type == 'development' %}
                                        <i class="fas fa-code"></i>
                                        {% elif log_entry.connection_type == 'documentation' %}
                                        <i class="fas fa-book"></i>
                                        {% elif log_entry.connection_type == 'analysis' %}
                                        <i class="fas fa-chart-line"></i>
                                        {% else %}
                                        <i class="fas fa-file-alt"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h3 class="card-title">{{ log_entry.post.title }}</h3>
                                        <p class="card-subtitle">{{ log_entry.get_connection_type_display }} â€¢ {{ log_entry.post.created_at|date:"M d, Y" }}</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="card-action">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="card-action">
                                        <i class="fas fa-share"></i>
                                    </button>
                                </div>
                                <div style="margin-top: var(--spacing-md);">
                                    {% if log_entry.post.excerpt %}
                                    <p style="color: var(--color-text-secondary); font-size: 0.9rem; line-height: 1.4;">
                                        {{ log_entry.post.excerpt|truncatewords:25 }}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- ðŸ”— Dependencies Panel -->
                {% if system.dependencies.exists or system.dependents.exists %}
                <div class="interface-panel" id="dependencies-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-project-diagram"></i>
                                <span>System Dependencies</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn">
                                    <i class="fas fa-expand-arrows-alt"></i>
                                    Full View
                                </button>
                            </div>
                        </div>
                        
                        {% if system.dependencies.exists %}
                        <div class="interface-section">
                            <h4 style="color: var(--color-text); margin-bottom: var(--spacing-md);">Dependencies</h4>
                            <div class="interactive-grid">
                                {% for dependency in system.dependencies.all %}
                                <div class="interactive-card" onclick="window.open('{% url 'projects:system_detail' slug=dependency.depends_on.slug %}', '_blank')">
                                    <div class="card-header">
                                        <div class="card-icon" style="background: rgba(255, 170, 0, 0.2); color: var(--color-warning);">
                                            {% if dependency.is_critical %}
                                            <i class="fas fa-exclamation-circle"></i>
                                            {% else %}
                                            <i class="fas fa-link"></i>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <h3 class="card-title">{{ dependency.depends_on.title }}</h3>
                                            <p class="card-subtitle">{{ dependency.get_dependency_type_display }} â€¢ {% if dependency.is_critical %}Critical{% else %}Optional{% endif %}</p>
                                        </div>
                                    </div>
                                    {% if dependency.description %}
                                    <div style="margin-top: var(--spacing-md);">
                                        <p style="color: var(--color-text-secondary); font-size: 0.9rem;">
                                            {{ dependency.description|truncatewords:20 }}
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if system.dependents.exists %}
                        <div class="interface-section">
                            <h4 style="color: var(--color-text); margin-bottom: var(--spacing-md);">Dependent Systems</h4>
                            <div class="interactive-grid">
                                {% for dependent in system.dependents.all %}
                                <div class="interactive-card" onclick="window.open('{% url 'projects:system_detail' slug=dependent.system.slug %}', '_blank')">
                                    <div class="card-header">
                                        <div class="card-icon" style="background: rgba(0, 255, 136, 0.2); color: var(--color-success);">
                                            {% if dependent.is_critical %}
                                            <i class="fas fa-exclamation-circle"></i>
                                            {% else %}
                                            <i class="fas fa-arrow-up"></i>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <h3 class="card-title">{{ dependent.system.title }}</h3>
                                            <p class="card-subtitle">{{ dependent.get_dependency_type_display }} â€¢ {% if dependent.is_critical %}Critical{% else %}Optional{% endif %}</p>
                                        </div>
                                    </div>
                                    {% if dependent.description %}
                                    <div style="margin-top: var(--spacing-md);">
                                        <p style="color: var(--color-text-secondary); font-size: 0.9rem;">
                                            {{ dependent.description|truncatewords:20 }}
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if not system.dependencies.exists and not system.dependents.exists %}
                        <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--border-radius-lg); padding: var(--spacing-xl); text-align: center; min-height: 300px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <i class="fas fa-project-diagram" style="font-size: 4rem; color: var(--color-teal); margin-bottom: var(--spacing-lg);"></i>
                            <h3 style="color: var(--color-text); margin-bottom: var(--spacing-md);">No Dependencies Found</h3>
                            <p style="color: var(--color-text-secondary); max-width: 600px; line-height: 1.6;">
                                This system operates independently without external dependencies or dependent systems.
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- ðŸ’» Terminal Panel -->
                <div class="interface-panel" id="terminal-panel">
                    <div class="interface-section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-terminal"></i>
                                <span>System Console</span>
                            </div>
                            <div class="section-actions">
                                <button class="section-action-btn">
                                    <i class="fas fa-download"></i>
                                    Export Logs
                                </button>
                                <button class="section-action-btn">
                                    <i class="fas fa-trash"></i>
                                    Clear
                                </button>
                            </div>
                        </div>
                        
                        <div class="terminal-container">
                            <div class="terminal-header">
                                <i class="fas fa-circle" style="color: #ff5f56;"></i>
                                <i class="fas fa-circle" style="color: #ffbd2e;"></i>
                                <i class="fas fa-circle" style="color: #27ca3f;"></i>
                                <span style="margin-left: var(--spacing-md);">{{ system.title }} System Console</span>
                            </div>
                            <div class="terminal-body">
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">system status</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">System: {{ system.title }}</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">Status: {{ system.get_status_display }}</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">Version: {{ system.version|default:"1.0.0" }}</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">system metrics</span>
                                </div>
                                {% if system.performance_score %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Performance: {{ system.performance_score }}%</span>
                                </div>
                                {% endif %}
                                {% if system.uptime_percentage %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Uptime: {{ system.uptime_percentage }}%</span>
                                </div>
                                {% endif %}
                                {% if system.daily_users %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Daily Users: {{ system.daily_users }}</span>
                                </div>
                                {% endif %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Team Size: {{ system.team_size|default:"1" }}</span>
                                </div>
                                {% if system.code_lines %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Lines of Code: {{ system.code_lines|floatformat:0 }}</span>
                                </div>
                                {% endif %}
                                {% if system.commit_count %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Total Commits: {{ system.commit_count }}</span>
                                </div>
                                {% endif %}
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">development status</span>
                                </div>
                                {% if system.actual_dev_hours %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Dev Hours: {{ system.actual_dev_hours }}h spent</span>
                                </div>
                                {% endif %}
                                {% if system.estimated_dev_hours %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Estimated: {{ system.estimated_dev_hours }}h total</span>
                                </div>
                                {% endif %}
                                <div class="terminal-line">
                                    <span class="terminal-output">Complexity: {{ system.get_complexity_display }}</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">Priority: {{ system.get_priority_display }}</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">git log --oneline -5</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">{{ system.updated_at|date:"Y-m-d H:i" }} Updated system documentation</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output">{{ system.created_at|date:"Y-m-d H:i" }} Initial system setup</span>
                                </div>
                                {% if system.technologies.exists %}
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">tech --list</span>
                                </div>
                                {% for tech in system.technologies.all|slice:":5" %}
                                <div class="terminal-line">
                                    <span class="terminal-output">{{ tech.name }} ({{ tech.get_category_display }})</span>
                                </div>
                                {% endfor %}
                                {% if system.technologies.count > 5 %}
                                <div class="terminal-line">
                                    <span class="terminal-output">... and {{ system.technologies.count|add:"-5" }} more</span>
                                </div>
                                {% endif %}
                                {% endif %}
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command">health check</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output" style="color: var(--color-success);">âœ“ System operational</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="terminal-output" style="color: var(--color-success);">âœ“ All services running</span>
                                </div>
                                {% if system.github_url %}
                                <div class="terminal-line">
                                    <span class="terminal-output" style="color: var(--color-success);">âœ“ Repository connected</span>
                                </div>
                                {% endif %}
                                {% if system.live_url %}
                                <div class="terminal-line">
                                    <span class="terminal-output" style="color: var(--color-success);">âœ“ Live deployment active</span>
                                </div>
                                {% endif %}
                                <div class="terminal-line">
                                    <span class="terminal-prompt">aura@{{ system.slug }}:~$</span>
                                    <span class="terminal-command cursor-blink">â–ˆ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block systems_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab Navigation
    const tabs = document.querySelectorAll('.interface-tab');
    const panels = document.querySelectorAll('.interface-panel');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Remove active class from all tabs and panels
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('active'));

            // Add active class to clicked tab
            tab.classList.add('active');

            // Show corresponding panel
            const panelId = tab.getAttribute('data-panel') + '-panel';
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.classList.add('active');
            }
        });
    });

    // Interactive card hover effects
    const cards = document.querySelectorAll('.interactive-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-4px)';
        });
        
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
        });
    });

    // Window controls interaction
    const closeBtn = document.querySelector('.window-control.close');
    const minimizeBtn = document.querySelector('.window-control.minimize');
    const maximizeBtn = document.querySelector('.window-control.maximize');
    
    if (closeBtn) {
        closeBtn.addEventListener('click', () => {
            if (confirm('Close system interface?')) {
                window.location.href = '{% url "projects:system_list" %}';
            }
        });
    }
    
    if (minimizeBtn) {
        minimizeBtn.addEventListener('click', () => {
            const interface = document.querySelector('.system-interface');
            interface.style.transform = 'scale(0.95)';
            interface.style.opacity = '0.8';
            setTimeout(() => {
                interface.style.transform = 'scale(1)';
                interface.style.opacity = '1';
            }, 300);
        });
    }
    
    if (maximizeBtn) {
        maximizeBtn.addEventListener('click', () => {
            const interface = document.querySelector('.system-interface');
            interface.classList.toggle('maximized');
        });
    }
});

// Refresh metrics function
function refreshMetrics() {
    // This would connect to real API endpoints in production
    console.log('Refreshing system metrics...');
    
    // Simulate loading state
    const refreshBtn = event.target.closest('.section-action-btn');
    const originalText = refreshBtn.innerHTML;
    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
    
    setTimeout(() => {
        refreshBtn.innerHTML = originalText;
        // Add a small success animation
        refreshBtn.style.background = 'rgba(0, 255, 136, 0.2)';
        setTimeout(() => {
            refreshBtn.style.background = '';
        }, 1000);
    }, 2000);
}

// Toggle feature view function
function toggleFeatureView() {
    const grid = document.querySelector('#features-panel .interactive-grid');
    grid.classList.toggle('list-view');
}

// Image modal function
function openImageModal(imageUrl, title) {
    // Create modal overlay
    const modal = document.createElement('div');
    modal.className = 'image-modal-overlay';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        cursor: pointer;
    `;
    
    const img = document.createElement('img');
    img.src = imageUrl;
    img.alt = title;
    img.style.cssText = `
        max-width: 90vw;
        max-height: 90vh;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    `;
    
    modal.appendChild(img);
    document.body.appendChild(modal);
    
    // Close modal on click
    modal.addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    // Close modal on escape key
    const escapeHandler = (e) => {
        if (e.key === 'Escape') {
            document.body.removeChild(modal);
            document.removeEventListener('keydown', escapeHandler);
        }
    };
    document.addEventListener('keydown', escapeHandler);
}

// Auto-refresh system status (every 30 seconds)
setInterval(() => {
    // This would check system health in production
    console.log('Checking system status...');
}, 30000);
</script>
{% endblock %}